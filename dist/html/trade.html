<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../css/style.css">
  <script src="../js/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.6.2/vuex.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="../js/gacha/pagination.js"></script>
  <title>角色交易</title>

  <style>
    .maskLayer {
      display: none;
    }

    .popShow {
      display: block;
    }

    .popUpBox {
      display: none;
    }

    .box1 {
      display: block;
    }
  </style>

</head>

<body>
  <!-- 首頁nav -->
<header id="header">
    <div class="container">
        <a class="logo" href="../html/index.html">
            <img src="../image/index/logo.png" alt="logoImg">
        </a>
        <nav class="navbar">
            <ul>
                <a href="../html/Intro.html">
                    <li>
                        <img src="../image/index/pic.png">
                        消息/介紹
                    </li>
                </a>
                <a href="../html/Gacha.html">
                    <li>
                        <img src="../image/index/pokemon.png">
                        角色抽取
                    </li>
                </a>
                <a href="../html/trade.html">
                    <li>
                        <img src="../image/index/role01.png">
                        角色交易
                    </li>
                </a>
            </ul>
        </nav>

        <!-- phone nav-->
        <nav class="hamburger">
            <div id="menuToggle">
                <input type="checkbox" />

                <span></span>
                <span></span>
                <span></span>

                <ul id="headerMenu">
                    <a href="../html/index.html"><img src="../image/index/logo.png"></a>
                    <a href="../html/Intro.html">
                        <li><img src="../image/index/pic.png">消息/介紹</li>
                    </a>
                    <a href="../html/Gacha.html">
                        <li><img src="../image/index/pokemon.png">角色抽取</li>
                    </a>
                    <a href="../html/trade.html">
                        <li><img src="../image/index/role01.png">角色交易</li>
                    </a>
                    <a href="#">
                        <div class="hamLog " id="LogOutPhone" onclick="LogOut()">登出</div>
                    </a>
                    <a href="#">
                        <div class="hamLog logbt LogInPhone" id="LogInPhone" onclick="LogIn()">登入</div>
                    </a>
                </ul>
            </div>
        </nav>
        <!-- phone nav end -->

        <div class="icon">
            <botton type="button" class="button disappear" id="appear1">
                <a href="../html/deposit.html"><i class="fas fa-coins fa-2x"></i></a>
                <p id="headerResult"></p>
                <div class="show">儲值</div>
            </botton>
            <botton type="button" class="button disappear" id="appear2">
                <a href="../html/collection.html"><i class="fab fa-gratipay fa-2x"></i></a>
                <div class="show">收藏</div>
            </botton>
            <botton type="button" class="button" onclick="memberCheck()">
                <a href="#"><i class="fas fa-user-circle fa-2x"></i>
                    <h5 id="headerCountResult" class="countResul _off"></h5>
                </a>
                <div class="show">會員</div>
            </botton>
            <botton type="button" id="LogOut" class="LogOut" onclick="LogOut()">
                <a href="#">登出</a>
            </botton>
            <botton type="button" id="LogIn" class="LogIn logbt" onclick="LogIn()">
                <a href="#">登入</a>
            </botton>
        </div>
    </div>
</header>
  <main class="allBlock1">



    <!-- 角色排行 -->

    <section class="roleRanksection">
      <h1>角色排行</h1>
      <div class="rankBloCk" id="rankBloCk">

      </div>
    </section>


    <!-- 未登入alert -->

    <div id="tologinBlk" class="toGachaBlk none">
      <section class="toGachaHintmaskLayer">
        <div class="toGachaPopUpBox">
          <div onclick="popCloseX(this)" class="toGachaCloseBtn">
            x
          </div>
          <div class="toGachaPopContent">
            <p>
              <i class="far fa-user-circle"></i>&nbsp;您尚未登入會員喔
            </p>
          </div>
          <div class="toGachaConfirmBlk">
            <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
            <button class="bonusConfirmBtn" onclick="tologIn()">登入或註冊～</button>
          </div>
        </div>
      </section>
    </div>

    <!-- 沒角色alert -->


    <div id="toGachaBlk" class="toGachaBlk none">
      <section class="toGachaHintmaskLayer">
        <div class="toGachaPopUpBox">
          <div onclick="popCloseX(this)" class="toGachaCloseBtn">
            x
          </div>
          <div class="toGachaPopContent">
            <p>
              <i class="far fa-user-circle"></i>&nbsp;您的角色不足，請前往扭蛋
            </p>
          </div>
          <div class="toGachaConfirmBlk">
            <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
            <button class="bonusConfirmBtn" onclick="toGacha()">前往扭蛋</button>
          </div>
        </div>
      </section>
    </div>

    <!-- 沒填價錢alert -->

    <div id="noPrice" class="toGachaBlk none">
      <section class="toGachaHintmaskLayer">
        <div class="toGachaPopUpBox">
          <div onclick="popCloseX(this)" class="toGachaCloseBtn">
            x
          </div>
          <div class="toGachaPopContent">
            <p>
              <i class="far fa-user-circle"></i>&nbsp;請填寫價錢
            </p>
          </div>
          <div class="toGachaConfirmBlk">
            <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
          </div>
        </div>
      </section>
    </div>


    <!-- 角色上架pop -->


    <main class="roleUpPop" id="app">

      <div class="btnBlockmy" id="box">
        <button type="button" class="btn111" @click=clickStatus()>角色上架</button>
        <button type="button" class="btn222" @click=clickStatus2()>我的角色管理</button>
      </div>


      <template id="=hiddenPopUps">

        <section class="maskLayer" :class="{'popShow':pop}">


          <!-- 角色上架pop-1 -->


          <div class="popUpBox" :class="{'box1':one}">
            <div class="closeBtn" @click=clickClose()>
              x
            </div>
            <div class="popContent">
              <h1>角色上架</h1>
              <div class="input">
                <div class="chooseRoleBlockk">
                  <h3>選擇角色</h3>
                  <div class="chooseRoleBlock" id="chooseRole">
                    <!-- 小圖 -->
                  </div>
                </div>
                <div class="showImgBlock" id="showImgBlock">
                  <img src="" id="showImg" name="" alt="">
                </div>
                <div class="informationBlock" action="" method="post">
                  <h3 id="roleName"></h3>

                  <label class="sellerAccountt" id="sellerAccount">賣家帳號: <span id="innerAccount"></span></label>

                  <br>

                  <label class="pricee"><span>販售價格: </span><input type="text" id="price" placeholder="請輸入價格"
                      name="sellprice"></label>

                  <br>

                  <div class="openChange">
                    <label id="openChange"><span>開啟交換:</span>
                      <input type="radio" name="choice" value="1" checked>
                      開啟
                      <input id="choice" type="radio" name="choice">
                      關閉
                    </label>
                  </div>

                  <br>

                  <div class="aBtnBlock">
                    <button class="aBtn" type="submit" @click=toTwo()>確定</button>
                  </div>

                </div>

              </div>
            </div>
          </div>

          <!-- 角色上架pop-2   -->

          <div class="popUpBox" :class="{'box1':two}">
            <div class="closeBtn" @click=clickClose()>
              x
            </div>
            <div class="popContent2" id="completeWord">
              您已完成角色上架
            </div>
            <div class="bBlock">
              <button class="b" @click=clickClose1()>確定</button>
            </div>
          </div>

          <!-- 角色管理pop -->

          <div class="popUpBox" :class="{'box1':three}">
            <div class="closeBtn" @click=clickClose()>
              x
            </div>
            <div class="popContent3">
              <h1>角色管理</h1>
              <div class="manageFlex">
                <ol class="manageListOut">
                  <li>
                    <div class="itemFlex first">
                      <div class="leftBlock">
                        <div class="imgBlockRole">
                          <img src="../image/trade/product1.png" style="visibility: hidden">
                        </div>
                      </div>

                      <div class="middleBlock">
                        <div class="detailInfo firstTitle">
                          <p class="roleNamee one">名稱</p>
                          <p class="rolePrice one">價錢</p>
                          <p class="roleNumber one">角色編號</p>
                        </div>
                      </div>

                      <div class="rightBlock">
                        <div class="btnBlock" style="visibility: hidden">
                          <button class="downBt">下架</button>
                          <button class="upBt">重新上架</button>
                          <button class="deleteBt"><i class="fas fa-trash"></i></button>
                        </div>
                      </div>
                    </div>
                  </li>
                </ol>

                <ol class="manageList" id="manageList">

                  <li>
                    <!-- 角色管理資料 -->
                  </li>


                </ol>


              </div>
            </div>
          </div>
        </section>

      </template>


    </main>


    <!-- 搜尋列 -->


    <section class="searchFlex">
      <div class="searchFlexleft">
        <input type="text" name="search" id="ysearchy" onkeyup="search()" placeholder="請輸入角色名稱">
        <button class="ysearchBtny" type="submit"><i class="fas fa-search"></i></button>
      </div>

      <div class="searchFlexRight">
        <button class="openBtn" data-toggle-class="foo" data-target="#bar" type="button">搜尋分類+</button>
        <div id="bar" class="none">
          <div>
            <input type="radio" name="searchRadio" id="1" onclick="search3000()">
            <label for="1">$3000E以上</label>
          </div>
          <div>
            <input type="radio" name="searchRadio" id="2" onclick="search2000()">
            <label for="2">$2000E~$3000E</label>
          </div>
          <div>
            <input type="radio" name="searchRadio" id="3" onclick="search1000()">
            <label for="3">$1000E~$2000E</label>
          </div>
          <div>
            <input type="radio" name="searchRadio" id="4" onclick="searchUnder1000()">
            <label for="4">$1000E以下</label>
          </div>
          <div>
            <input type="radio" name="searchRadio" id="5" onclick="searchAll()">
            <label for="5">全部角色</label>
          </div>
          <div>
            <input type="radio" name="searchRadio" id="6" onclick="searchTrans()">
            <label for="6">可交換</label>
          </div>
        </div>

      </div>
    </section>



    <!-- 商品列表 -->

    <main class="ymainy">
      <div class="containerFlex" id="containerFlex">
      </div>

    </main>

    <!-- page -->

    <section class="ypagey">
      <div class="pagination">
        <ul class="pagination_list">
          <li class="prev" onclick="prev()">&lt;</li>
          <li class="pageNumber one focus" onclick="callAllRole(1)">1</li>
          <li class="pageNumber two" onclick="callAllRole(2)">2</li>
          <li class="pageNumber three" onclick="callAllRole(3)">3</li>
          <li class="pageNumber four" onclick="callAllRole(4)">4</li>
          <li class="pageNumber five" onclick="callAllRole(5)">5</li>
          <li class="next" onclick="next()">&gt;</li>
        </ul>
      </div>
    </section>
  </main>
  <!-- footer -->
<footer class="footer">
    <div class="iconLink">
        <a href="#"><i class="fab fa-facebook-square fa-2x i"></i></a>
        <a href="#"><i class="fab fa-instagram fa-2x"></i></a>
        <a href="#"><i class="fab fa-twitter-square fa-2x i"></i></a>
    </div>
    <div class="notice">
        <p>
            本網站為緯育TibaMe前端設計工程師班第70期第一組學員專題成果作品，本平台僅供學習、展示之用。<br>
            參考資源： 馬力歐賽車、NFT。若有侵權疑慮，您可以私訊 [ 緯育TibaMe ]，後續會由專人協助處理
        </p>
    </div>
    <div class="copyright">
        <p><i class="far fa-copyright"></i> 2021 怪哩怪汽 All Rights Reserved</p>
    </div>
</footer>


  <!-- popup視窗vue & ajax -->

  <script>

    let vm = new Vue({
      el: "#app",
      data: {
        pop: false,
        one: true,
        two: false,
        three: false,
      },
      methods: {
        clickStatus() {
          $.ajax({
            method: "POST",
            url: "../php/LoginCheck.php",
            data: {},
            dataType: "text",
            success: function (response) {
              let tologinBlk = document.getElementById('tologinBlk');
              if (response == "") {
                tologinBlk.classList.remove('none');
              } else {
                clickPop();
              }
            }
          })
        },
        clickStatus2() {
          $.ajax({
            method: "POST",
            url: "../php/LoginCheck.php",
            data: {},
            dataType: "text",
            success: function (response) {
              let tologinBlk = document.getElementById('tologinBlk');
              if (response == "") {
                tologinBlk.classList.remove('none');
              } else {
                toThree();
              }
            }
          })
        },
        clickClose() {
          $.ajax({
            method: "POST",
            url: "../php/product/callAllRole.php",
            data: {},
            dataType: "json",
            success: function (response) {

              let containerFlex = document.getElementById('containerFlex');
              containerFlex.innerHTML = "";

              $.each(response, function (index, row) {
                let redShadow = "";
                let shadowNone = "";
                let trans = ""
                if (row.TRANS == 1) {
                  redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
                  shadowNone = `this.style.boxShadow='none'`;
                }
                let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>$${row.PRICE}E</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

                containerFlex.insertAdjacentHTML("beforeend", str);
                let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
                console.log(liTrans);
                if (`${row.TRANS}` == 0) {
                  liTrans.innerHTML = "";
                }
              })
              vm.$data.pop = false;
              vm.$data.two = false;


            },
            error: function (exception) {
              alert("數據載入失敗: " + exception.status);
            }
          });

          $.ajax({
            method: "POST",
            url: "../php/product/callRank.php",
            data: {},
            dataType: "json",
            success: function (response) {

              let rankBloCk = document.getElementById('rankBloCk');
              rankBloCk.innerHTML = "";

              $.each(response, function (index, row) {
                let str = `<div class="roleBloCk1">
                                                  <div class="imgBlock">
                                                      <img src="../image/ROLE/${row.ROLE_IMG}" >
                                                  </div>
                                      
                                                  <div class="name">
                                                      <p>${row.RNAME}</p>
                                                  </div>
                                      
                                                  <div class="price">$${row.PRICE}E</div>
                                              </div>`;

                rankBloCk.insertAdjacentHTML("beforeend", str);

              })
            },
            error: function (exception) {
              alert("數據載入失敗: " + exception.status);
            }
          });
        },
        toTwo() {
          // console.log(document.getElementById('choice').value);
          let check = document.querySelector('input[id="choice"]:checked');
          let checkValue = null;
          if (check != null) {
            checkValue = 0;
          } else {
            checkValue = 1;
          }

          let username = document.getElementById('innerAccount').innerText;

          let price = document.getElementById('price').value;

          let gachaId = document.getElementById("showImg").attributes['name'].value;
          // console.log(gachaId);

          let status = document.getElementById("showImg").attributes['alt'].value;
          // console.log(status);

          if (status == 1) {
            status = 0;
          } else {
            status = 1;
          }

          // 有沒有填寫售價

          let noPrice = document.getElementById('noPrice');

          if (price == "") {
            noPrice.classList.remove('none');
            return false;
          }

          /////////////// 確定上架功能

          $.ajax({
            method: "POST",
            url: "../php/product/upProduct.php",
            data: {
              GACHA_ID: gachaId,
              USERNAME: username,
              PRICE: price,
              TRANS: checkValue,
              STATUS: status,
            },
            dataType: "text",
            success: function (response) {
              vm.$data.two = true;
              vm.$data.one = false;
            },
            error: function (exception) {
              alert("數據載入失敗: " + exception.status);
            }
          });
        },
        clickClose1() {
          $.ajax({
            method: "POST",
            url: "../php/product/callAllRole.php",
            data: {},
            dataType: "json",
            success: function (response) {

              let containerFlex = document.getElementById('containerFlex');
              containerFlex.innerHTML = "";

              $.each(response, function (index, row) {
                let redShadow = "";
                let shadowNone = "";
                let trans = ""
                if (row.TRANS == 1) {
                  redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
                  shadowNone = `this.style.boxShadow='none'`;
                }
                let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}" name="${row.ABILITY}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>$${row.PRICE}E</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

                containerFlex.insertAdjacentHTML("beforeend", str);
                let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
                console.log(liTrans);
                if (`${row.TRANS}` == 0) {
                  liTrans.innerHTML = "";
                }
              })
              vm.$data.pop = false;
              vm.$data.two = false;

            },
            error: function (exception) {
              alert("數據載入失敗: " + exception.status);
            }
          });

          $.ajax({
            method: "POST",
            url: "../php/product/callRank.php",
            data: {},
            dataType: "json",
            success: function (response) {

              let rankBloCk = document.getElementById('rankBloCk');
              rankBloCk.innerHTML = "";

              $.each(response, function (index, row) {
                let str = `<div class="roleBloCk1">
                                                  <div class="imgBlock">
                                                      <img src="../image/ROLE/${row.ROLE_IMG}" >
                                                  </div>
                                      
                                                  <div class="name">
                                                      <p>${row.RNAME}</p>
                                                  </div>
                                      
                                                  <div class="price">$${row.PRICE}E</div>
                                              </div>`;

                rankBloCk.insertAdjacentHTML("beforeend", str);

              })
            },
            error: function (exception) {
              alert("數據載入失敗: " + exception.status);
            }
          });
        },
        },
      },
    );


    //////////////角色上架

    function clickPop() {
      $.ajax({
        method: "POST",
        url: "../php/product/callMemberRole.php",
        data: {},
        dataType: "json",
        success: function (response) {

          let chooseRole = document.getElementById('chooseRole');
          chooseRole.innerHTML = "";
          //chooseRole.insertAdjacentHTML("afterbegin",` <h3>選擇角色</h3>`);

          let innerAccount = document.getElementById('innerAccount');
          innerAccount.innerHTML = "";


          $.each(response, function (index, row) {
            let str = ` <img src="../image/ROLE/${row.ROLE_IMG}" onclick="chooseImg(this)" style="width:120px;" id="${row.RNAME}" name= "${row.GACHA_ID}" alt="${row.STATUS}">`;
            chooseRole.insertAdjacentHTML("beforeend", str);
            innerAccount.innerHTML = `${row.FK_USERNAME}`;


          })
          let chooseRoleChild = document.getElementById("chooseRole").childNodes[1];
          console.log(chooseRoleChild);
          // 判斷是否有角色
          let toGachaBlk = document.getElementById('toGachaBlk');
          if (chooseRoleChild == null) {
            toGachaBlk.classList.remove('none');
            vm.$data.pop = false;
          }
          let showImg = document.getElementById("showImg");
          let N = chooseRoleChild.attributes['src'].value;
          showImg.attributes['src'].value = `${N}`;
          let roleName = document.getElementById('roleName');
          let roleId = chooseRoleChild.attributes['id'].value;
          let gachaId = chooseRoleChild.attributes['name'].value;
          roleName.innerText = roleId;
          showImg.attributes['name'].value = gachaId;
          let status = chooseRoleChild.attributes['alt'].value;
          showImg.attributes['alt'].value = status;
          let checkHaveRole = chooseRole.innerHTML


        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });
      vm.$data.pop = true;
      vm.$data.one = true;
      vm.$data.three = false;
    }

    //////////////// 我的角色管理

    function toThree() {
      vm.$data.pop = true;
      vm.$data.three = true;

      $.ajax({
        method: "POST",
        url: "../php/product/roleManage.php",
        data: {},
        dataType: "JSON",
        success: function (response) {

          let manageList = document.getElementById('manageList');
          manageList.innerHTML = "";

          $.each(response, function (index, row) {
            let liList1 = `<li>
                                              <div class="itemFlex">  
                                                <div class="leftBlock">
                                                  <div class="imgBlockRole">
                                                    <img src="../image/ROLE/${row.ROLE_IMG}">
                                                  </div>
                                                </div>

                                                <div class="middleBlock">
                                                  <div class="detailInfo">
                                                    <p class="roleNamee">${row.RNAME}</p>
                                                    <p class="rolePrice">$${row.PRICE}E</p>
                                                    <p class="roleNumber" name="${row.FK_GACHA_ID}">編號:${row.ROLE_ID}</p>
                                                  </div>
                                                </div>
                      
                                                <div class="rightBlock">
                                                  <div class="btnBlock">
                                                    <button class="downBt" onclick="down(this)">下架</button>
                                                  </div>
                                                </div>
                                              </div>
                                            </li>`;
            let liList0 = `<li>
                                              <div class="itemFlex">  
                                                <div class="leftBlock">
                                                  <div class="imgBlockRole">
                                                    <img src="../image/ROLE/${row.ROLE_IMG}" >
                                                  </div>
                                                </div>

                                                <div class="middleBlock">
                                                  <div class="detailInfo">
                                                    <p class="roleNamee">${row.RNAME}</p>
                                                    <p class="rolePrice">${row.PRICE}</p>
                                                    <p class="roleNumber" name="${row.FK_GACHA_ID}">${row.ROLE_ID}</p>
                                                  </div>
                                                </div>
                      
                                                <div class="rightBlock">
                                                  <div class="btnBlock">
                                                    <button class="upBt" onclick="up(this)">重新上架</button>
                                                    <button class="deleteBt" onclick="dele(this)"><i class="fas fa-trash"></i></button>
                                                  </div>
                                                </div>
                                              </div>
                                            </li>`;
            if (`${row.AMOUNT}` == 1) {
              manageList.insertAdjacentHTML("beforeend", liList1);
            } else {
              manageList.insertAdjacentHTML("beforeend", liList0);
            }
          })
        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋開關 -->

  <script>
    const toggleClass = document.querySelectorAll('[data-toggle-class]');
    if (toggleClass) {
      for (let i = 0; i < toggleClass.length; i += 1) {
        const elem = toggleClass[i];
        elem.addEventListener('click', () => {
          const className = elem.getAttribute('data-toggle-class');
          const target = elem.getAttribute('data-target').slice(1);
          document.getElementById(target).classList.toggle(className);
        });
      }
    }
  </script>

  <!-- 點小圖切換圖片 -->

  <script>
    function chooseImg(item) {
      console.log(item);
      let N = item.attributes['src'].value;
      //console.log(N);
      showImg.attributes['src'].value = `${N}`;
      let roleName = document.getElementById('roleName');
      roleName.innerHTML = item.attributes['id'].value;
      let name = item.attributes['name'].value;
      showImg.attributes['name'].value = name;
    }

  </script>

  <!-- 下架click function -->

  <!-- let gachaID = item.parentNode.parentNode.previousSibling.previousSibling.childNodes[1].childNodes[5].innerText; -->

  <script>
    function down(item) {
      item.classList.add('none');
      let n = item.parentNode.parentNode.previousSibling.previousSibling.childNodes[1].childNodes[5];
      let gachaID = n.attributes['name'].value;
      console.log(gachaID);
      let changeStatus = item.parentNode;
      let str = `
            <button class="upBt" onclick="up(this)">重新上架</button>
            <button class="deleteBt" onclick="dele(this)"><i class="fas fa-trash"></i></button>
            `;
      changeStatus.innerHTML = str;
      console.log(gachaID);

      $.ajax({
        method: "POST",
        url: "../php/product/down.php",
        data: {
          GACHA_ID: gachaID
        },
        dataType: "TEXT",
        success: function (response) {

        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });

    }

  </script>

  <!-- 重新上架click function -->

  <script>
    function up(item) {
      // console.log(item.parentNode.parentNode.parentNode.parentNode);
      // let x = item.parentNode.parentNode.parentNode.parentNode;
      // x.innerHTML="";
      // item.classList.add('none');
      let n = item.parentNode.parentNode.previousSibling.previousSibling.childNodes[1].childNodes[5];
      let gachaID = n.attributes['name'].value;
      console.log(gachaID)
      let changeStatus = item.parentNode;
      let str = `
                <button class="downBt" onclick="down(this)">下架</button>
                `;
      changeStatus.innerHTML = str;


      console.log(gachaID);

      $.ajax({
        method: "POST",
        url: "../php/product/up.php",
        data: {
          GACHA_ID: gachaID
        },
        dataType: "TEXT",
        success: function (response) {

        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });

    }
  </script>


  <!-- 刪除click function -->

  <script>
    function dele(item) {
      let gachaID = item.parentNode.parentNode.previousSibling.previousSibling.childNodes[1].childNodes[5].attributes['name'].value;
      
      console.log(gachaID);
      //console.log(item.parentNode.parentNode.parentNode.parentNode);
      let x = item.parentNode.parentNode.parentNode.parentNode;
      x.innerHTML = "";

      $.ajax({
        method: "POST",
        url: "../php/product/delete.php",
        data: {
          GACHA_ID: gachaID
        },
        dataType: "TEXT",
        success: function (response) {

        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });

    }
  </script>


  <!-- 角色排行 -->
  <script>
    $.ajax({
      method: "POST",
      url: "../php/product/callRank.php",
      data: {},
      dataType: "json",
      success: function (response) {

        let rankBloCk = document.getElementById('rankBloCk');
        rankBloCk.innerHTML = "";

        $.each(response, function (index, row) {
          let str = `<div class="roleBloCk1">
                                            <div class="imgBlock">
                                                <img src="../image/ROLE/${row.ROLE_IMG}" >
                                            </div>
                                
                                            <div class="name">
                                                <p>${row.RNAME}</p>
                                            </div>
                                
                                            <div class="price">$${row.PRICE}E</div>
                                        </div>`;

          rankBloCk.insertAdjacentHTML("beforeend", str);

        })
      },
      error: function (exception) {
        alert("數據載入失敗: " + exception.status);
      }
    });
  </script>



  <!-- 商城 -->

  <script>
    window.onload = callAllRole(1);
    function callAllRole(page) {
      $.ajax({
        method: "POST",
        url: "../php/product/callAllRole.php",
        data: {},
        dataType: "json",
        success: function (response) {

          let containerFlex = document.getElementById('containerFlex');
          containerFlex.innerHTML = "";

          $.each(response, function (index, row) {
            if ((page - 1) * 8 <= index && index < page * 8) {
              let redShadow = "";
              let shadowNone = "";
              let trans = ""
              if (row.TRANS == 1) {
                redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
                shadowNone = `this.style.boxShadow='none'`;
              }
              let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}" onclick="productcookie(this)" name="${row.ABILITY}">
                                            
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>$${row.PRICE}E</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            
                                        </div>`;

              containerFlex.insertAdjacentHTML("beforeend", str);
              let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
              console.log(liTrans);
              if (`${row.TRANS}` == 0) {
                liTrans.innerHTML = "";
              }
            }
          })
        },
        error: function (exception) {
          alert("數據載入失敗: " + exception.status);
        }
      });
    }
    function prev() {
      let page = document.querySelector('.pagination_list').querySelector(".focus").innerText - 1;
      if (page == 0) {
        return false;
      } else {
        callAllRole(page);
      }
    }
    function next() {
      let page = document.querySelector('.pagination_list').querySelector(".focus").innerText;
      callAllRole(parseInt(page) + 1);
    }
  </script>

  <!-- 搜尋角色名字function -->

  <script>
    function search() {
      let keyUpValue = document.getElementById('ysearchy').value;
      $.ajax({
        method: "POST",
        url: "../php/product/searchRole.php",
        data: {
          search: keyUpValue,
        },
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋3000以上 function -->

  <script>
    function search3000() {
      $.ajax({
        method: "POST",
        url: "../php/product/search3000.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋2000-3000 function -->

  <script>
    function search2000() {
      $.ajax({
        method: "POST",
        url: "../php/product/search2000.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋1000-2000 function -->

  <script>
    function search1000() {
      $.ajax({
        method: "POST",
        url: "../php/product/search1000.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋1000以下 function -->

  <script>
    function searchUnder1000() {
      $.ajax({
        method: "POST",
        url: "../php/product/searchUnder1000.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋全部角色 function -->

  <script>
    function searchAll() {
      $.ajax({
        method: "POST",
        url: "../php/product/searchAll.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>

  <!-- 搜尋可交換 function -->

  <script>
    function searchTrans() {
      $.ajax({
        method: "POST",
        url: "../php/product/searchTrans.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //更新html內容前先清空原有資料
          let memberContent = document.getElementById('containerFlex');
          memberContent.innerHTML = "";


          //更新html內容(透過jQuery跑迴圈取值)
          $.each(response, function (index, row) {
            let redShadow = "";
            let shadowNone = "";
            let trans = ""
            if (row.TRANS == 1) {
              redShadow = `this.style.boxShadow='rgba(255, 81, 68, 0.8) 0px 19px 38px, rgba(243, 48, 57, 0.2) 0px 15px 12px'`;
              shadowNone = `this.style.boxShadow='none'`;
            }
            let str = `<div class="container" id="${row.PRODUCT_ID}"onMouseOver="${redShadow}"  onMouseOut="${shadowNone}">
                                            <a href="./product.html">
                                            <div class="inner">
                                                <div class="content">

                                                    <span><img src="../image/ROLE/${row.ROLE_IMG}"></span>
                                                    <h2>${row.RNAME}</h2>
                                                    <h3>${row.PRICE}</h3>
                                                </div>
                                                <div class="lower">
                                                    <ul class="features-list">
                                                        <li class="${row.TRANS}">可交換</li>
                                                        <div class="ysellerImgy">
                                                            <img src="../image/ROLE/${row.USER_IMG}" alt="">
                                                        </div>
                                                        <li>${row.FK_USERNAME}</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <button class="cta">查看資訊</button>
                                            </a>
                                        </div>`;

            containerFlex.insertAdjacentHTML("beforeend", str);
            let liTrans = document.getElementsByClassName(`${row.TRANS}`)[0];
            console.log(liTrans);
            if (`${row.TRANS}` == 0) {
              liTrans.innerHTML = "";
            }
          })
        },
        error: function (exception) {
          alert("發生錯誤: " + exception.status);
        }
      });
    }
  </script>


  <!-- 未登入彈窗function -->

  <script>
    function popClose(item) {
      let blk = item.parentNode.parentNode.parentNode.parentNode;
      blk.classList.add('none');
    }
    function popCloseX(item) {
      let blk = item.parentNode.parentNode.parentNode;
      blk.classList.add('none');
    }
    function tologIn() {
      location.href = "./login.html";
    };
    function toGacha() {
      location.href = "./Gacha.html";
    };
  </script>
  <script>
    function productcookie(item) {
      // console.log(item.attributes[1].value);
      let productname = item.attributes[1].value;
      let ab = item.attributes['name'].value;
      sessionStorage.clear();
      sessionStorage.setItem('productname', productname);
      sessionStorage.setItem('ab', ab);
      // console.log(item.attributes['name'].value);

      location.href = "./product.html";


    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
</body>

</html>