<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>collection</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="../js/vendor/js/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>

    <header id="header">
        <div class="container">
            <a class="logo" href="../html/index.html">
                <img src="../image/index/logo.png" alt="logoImg">
            </a>
            <nav class="navbar">
                <ul>
                    <a href="../html/Intro.html">
                        <li>
                            <img src="../image/index/pic.png">
                            消息/介紹
                        </li>
                    </a>
                    <a href="../html/Gacha.html">
                        <li>
                            <img src="../image/index/pokemon.png">
                            角色抽取
                        </li>
                    </a>
                    <a href="../html/trade.html">
                        <li>
                            <img src="../image/index/role01.png">
                            角色交易
                        </li>
                    </a>
                </ul>
            </nav>

            <!-- phone nav-->
            <nav class="hamburger">
                <div id="menuToggle">
                    <input type="checkbox" />

                    <span></span>
                    <span></span>
                    <span></span>

                    <ul id="headerMenu">
                        <a href="../html/index.html"><img src="../image/index/logo.png"></a>
                        <a href="../html/Intro.html">
                            <li><img src="../image/index/pic.png">消息/介紹</li>
                        </a>
                        <a href="../html/Gacha.html">
                            <li><img src="../image/index/pokemon.png">角色抽取</li>
                        </a>
                        <a href="../html/trade.html">
                            <li><img src="../image/index/role01.png">角色交易</li>
                        </a>
                        <a href="#">
                            <div class="hamLog " id="LogOutPhone" onclick="LogOut()">登出</div>
                        </a>
                        <a href="#">
                            <div class="hamLog logbt LogInPhone" id="LogInPhone" onclick="LogIn()">登入</div>
                        </a>
                    </ul>
                </div>
            </nav>
            <!-- phone nav end -->

            <div class="icon">
                <botton type="button" class="button bt disappear" id="appear1">
                    <a href="../html/deposit.html"><i class="fas fa-coins fa-2x"></i></a>
                    <p id="headerResult"></p>
                    <div class="show">儲值</div>
                </botton>
                <botton type="button" class="button disappear" id="appear2">
                    <a href="../html/collection.html"><i class="fab fa-gratipay fa-2x"></i></a>
                    <div class="show Change">收藏</div>
                </botton>
                <botton type="button" class="button" onclick="memberCheck()">
                    <a href="#"><i class="fas fa-user-circle fa-2x"></i>
                        <h5 id="headerCountResult" class="countResul _off"></h5>
                    </a>
                    <div class="show">會員</div>
                </botton>
                <botton type="button" id="LogOut" class="LogOut" onclick="LogOut()">
                    <a href="#">登出</a>
                </botton>
                <botton type="button" id="LogIn" class="LogIn logbt" onclick="LogIn()">
                    <a href="#">登入</a>
                </botton>
            </div>
        </div>
    </header>


    <main class="collection" id="vmm">
        <p class="breadcrumb">首頁>購物車</p>
        <div class="container">

            <div class="collect_contain col-12">
                <div class="contain_bar">
                    <span class="block col-2">
                        <p class="rwd_title">收藏清單</p>
                    </span>
                    <span class="role_name col-2">角色名稱</span>
                    <span class="ability col-3">角色能力值</span>
                    <span class="my_role col-2">價格(E)</span>
                    <span class="product col-2">交易方式</span>
                    <span class="status col-1">刪除</span>
                </div>
                <!-- php回傳到這 -->
                <div id="result"></div>
                <div id="result_off"></div>

            </div>
        </div>

        <!-- 彈跳視窗 -->
        <!-- <template id="=hiddenPopUps">

            <section class="maskLayer" :class="{'popShow':pop}">

                <-- 購買 -->
        <!-- <div class="popUpBox maskBlockM" :class="{'popBox':buy}">
            <div class="closeBtn" @click=clickClose()>
                x
            </div>
            <div class="popContent">
                <div class="popContent">
                    <p>是否確認從帳戶扣除 $***點，交易 *****角色?</p>
                </div>
                <div class="confirmBlk">
                    <button class="confirmBtn" @click=toSuccess()>是</button>
                    <button class="confirmBtn" @click=clickClose()>否</button>
                </div>
            </div>
        </div> -->

        <!-- 購買成功 -->

        <!-- <div class="popUpBox maskBlockM" :class="{'popBox':success}">
                    <div class="closeBtn" @click=clickClose()>
                        x
                    </div>
                    <div class="popContent">
                        <p>您已成功購買</p>
                    </div>
                    <div class="confirmBlk">
                        <button class="confirmBtn" @click=clickClose()>確定</button>
                    </div>
                </div> -->

        <!-- 交換 -->
        <!-- <div class="popUpBox test" :class="{'box':one}">
                    <div class="closeBtn" @click=clickClose()>
                        x
                    </div>
                    <div class="popContent12">
                        <p>選擇你要申請交換的角色</p>
                    </div>

                    <div class="roleBlock1Mark">
                        <ul class="roleList1Mark">
                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>

                            <li>
                                <div class="imgBlock1Mark">
                                    <img src="">
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div class="confirmBlk12">
                        <a href="#" class="confirmBtn12" @click=toTwo()>確定</a>
                    </div>

                </div>


                <div class="popUpBox test" :class="{'box':two}">
                    <div class="closeBtn" @click=clickClose()>
                        x
                    </div>
                    <div class="popContent13">
                        <p>確認你想要交換的角色</p>
                    </div>

                    <div class="myRoleBlock">
                        <div class="myRoleP">
                            <p>我的角色</p>
                        </div>

                        <div class="myRoleImg">
                            <img src="">
                        </div>

                        <div class="myRoleNameBlock">
                            <p>小烏龜</p>
                        </div>
                    </div>

                    <div class="doubleArrow"><i class="fas fa-arrows-alt-h"></i></div>

                    <div class="yourRoleBlock">
                        <div class="yourRoleP">
                            <p>對方角色</p>
                        </div>

                        <div class="yourRoleImg">
                            <img src="">
                        </div>

                        <div class="yourRoleNameBlock">
                            <p>羊咩咩</p>
                        </div>
                    </div>

                    <div class="confirmBlk13">
                        <a href="#" class="confirmBtn13" @click=toThree()>確定</a>
                    </div>

                </div> -->

        <!-- 交換完成 -->
        <!-- <div class="popUpBox test" :class="{'box':three}">
            <div class="closeBtn" @click=clickClose()>
                x
            </div>
            <div class="popContent14">
                <p>以送出交換申請，請靜候佳音！</p>
            </div>
        </div> -->

        <!-- 沒有點數alert -->

        <div id="noPointBlk" class="noPointBlk none">
            <section class="noPointHintmaskLayer">
                <div class="noPointPopUpBox">
                    <div onclick="popCloseX(this)" class="noPointCloseBtn">
                        x
                    </div>
                    <div class="noPointPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您的點數不足，請前往儲值
                        </p>
                    </div>
                    <div class="noPointConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <button class="bonusConfirmBtn" onclick="toPoints()">前往儲值</button>
                    </div>
                </div>
            </section>
        </div>
        <!-- 購買確認Pop -->
        <div id="BuyingBlk" class="BuyingBlk none" name="">
            <section class="BuyingHintmaskLayer">
                <div class="BuyingPopUpBox">
                    <div onclick="popCloseX(this)" class="BuyingCloseBtn">
                        x
                    </div>
                    <div class="BuyingPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;是否購入本隻角色？
                        </p>
                    </div>
                    <div class="BuyingConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">否</button>
                        <button class="bonusConfirmBtn" onclick="buyRole(this)">是</button>
                    </div>
                </div>
            </section>
        </div>
        <!-- 購買成功 -->
        <div id="successBlk" class="noPointBlk none">
            <section class="noPointHintmaskLayer">
                <div class="noPointPopUpBox">
                    <div onclick="popCloseX(this)" class="noPointCloseBtn">
                        x
                    </div>
                    <div class="noPointPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您已購買成功
                        </p>
                    </div>
                    <div class="noPointConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">確定</button>
                        <!-- <button class="bonusConfirmBtn" onclick="toPoints()">前往儲值</button> -->
                    </div>
                </div>
            </section>
        </div>

        <!-- 交換彈窗 -->
        <section class="sec1 none" id="transBlk">
            <div class="flexContainer" id="flexContainer">
            </div>

            <main class="test">

                    <!-- <section class="maskLayer"> -->

                        <div class="popUpBox" id="one">
                            <div class="closeBtn" onclick=clickClose()>
                                x
                            </div>
                            <div class="popContent12">
                                <p>選擇你要申請交換的角色</p>
                            </div>

                            <div class="roleBlock1Mark">
                                <ul class="roleList1Mark" id="roleList1Mark">

                                </ul>
                            </div>
                        </div>


                        <div id="popUpBox2" class="popUpBox none" :class="{'box':two}">
                            <div class="closeBtn" onclick=clickClose()>
                                x
                            </div>
                            <div class="popContent13">
                                <p>確認你想要交換的角色</p>
                            </div>
                            <div class="roleArea">
                                <div class="myRoleBlock">
                                    <div class="myRoleP">
                                        <p>我的角色</p>
                                    </div>

                                    <div class="myRoleImg">
                                        <img id="myRoleImg1" src="">
                                    </div>

                                    <div class="myRoleNameBlock">
                                        <p id="myRoleName1"></p>
                                    </div>
                                </div>

                                <div class="doubleArrow"><i class="fas fa-arrows-alt-h"></i></div>

                                <div class="yourRoleBlock">
                                    <div class="yourRoleP">
                                        <p>對方角色</p>
                                    </div>

                                    <div class="yourRoleImg">
                                        <img id="yourRoleImg1" src="">
                                    </div>
                                    <div class="yourRoleNameBlock">
                                        <p id="yourRoleName1"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="confirmBlk13">
                                <button href="#" class="confirmBtnBack13" onclick=toBack()>返回</button>
                                <button href="#" class="confirmBtn13" onclick="toThree(this)">確定</button>
                            </div>

                        </div>

                        <div class="popUpBox none" :class="{'box':three}" id="three" name="">
                            <div class="closeBtn" onclick=clickClose()>
                                x
                            </div>
                            <div class="popContent14">
                                <p class="sendP">已送出交換申請</br>請靜候佳音！</p>
                            </div>

                        </div>
                    <!-- </section> -->
            </main>
        </section>

        <!-- 沒角色alert -->
        <div id="toGachaBlk" class="toGachaBlk none">
            <section class="toGachaHintmaskLayer">
                <div class="toGachaPopUpBox">
                    <div onclick="popCloseX(this)" class="toGachaCloseBtn">
                        x
                    </div>
                    <div class="toGachaPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您的角色不足，請前往扭蛋
                        </p>
                    </div>
                    <div class="toGachaConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <button class="bonusConfirmBtn" onclick="toGacha()">前往扭蛋</button>
                    </div>
                </div>
            </section>
        </div>




        </section>

        </template>
    </main>


    <!-- footer -->
    <footer class="footer">
        <div class="iconLink">
            <a href="#"><i class="fab fa-facebook-square fa-2x i"></i></a>
            <a href="#"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="#"><i class="fab fa-twitter-square fa-2x i"></i></a>
        </div>
        <div class="notice">
            <p>
                本網站為緯育TibaMe前端設計工程師班第70期第一組學員專題成果作品，本平台僅供學習、展示之用。<br>
                參考資源： 馬力歐賽車、NFT。若有侵權疑慮，您可以私訊 [ 緯育TibaMe ]，後續會由專人協助處理
            </p>
        </div>
        <div class="copyright">
            <p><i class="far fa-copyright"></i> 2021 怪哩怪汽 All Rights Reserved</p>
        </div>
    </footer>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"> </script>
    <script src="../js/member/collection.js"></script>
    <script src="../js/news/news_in.js"></script>
    <script src="../js/header/header.js"></script>
    <script>
        window.onload = function () {
            status();
            display();
        }
        // 購買
        function buyingCheck(item) {
            // console.log(item);
            let BuyingBlk = document.getElementById('BuyingBlk');
            BuyingBlk.classList.remove('none');
             BuyingBlk.attributes['name'].value=item;
        }
        function buyRole(item) {
            let successBlk = document.getElementById('successBlk');
            let PRODUCT_ID = item.parentNode.parentNode.parentNode.parentNode.attributes['name'].value;
            $.ajax({
                method: "POST",
                url: "../php/product/buyRole.php",
                data: {
                    PRODUCT_ID: PRODUCT_ID,
                },
                dataType: "text",
                success: function (response) {

                    if (response == "y") {
                        // 有錢而且成功
                        successBlk.classList.remove('none');
                        let BuyingBlk = document.getElementById('BuyingBlk');
                         BuyingBlk.classList.add('none');
                    } else if (response = "no") {
                        // 沒錢
                        noPointBlk.classList.remove('none');
                    }
                }
            })
        };
        //交換
        function clickPopp(item) {
            // 判斷是否有角色
                let transBlk = document.getElementById('transBlk');
                transBlk.classList.remove('none');
                let yourName = item.parentNode.parentNode.childNodes[3].innerText;
                let yourImg = item.parentNode.parentNode.childNodes[1].childNodes[0].attributes['src'].value;
                let pID = item.parentNode.parentNode.attributes['name'].value;
                $.ajax({
                    method: "POST",
                    url: "../php/product/callChangeRole.php",
                    data: {},
                    dataType: "json",
                    success: function (response) {

                        let roleList1Mark = document.getElementById('roleList1Mark');
                        roleList1Mark.innerHTML = "";

                        $.each(response, function (index, row) {
                            let str = `<li onclick=toTwo(this)>
                                <span name="${yourName}" class="${yourImg}" id="${pID}"></span>
                                            <div class="imgBlock1Mark" id="imgBlock1Mark" name="${row.GACHA_ID}">
                                                <img src="../image/ROLE/${row.ROLE_IMG}" id="${row.RNAME}" name= "${row.FK_USERNAME}">
                                            </div>
                                        </li>`;
                            roleList1Mark.insertAdjacentHTML("beforeend", str);
                        })
                        let roleList1MarkChild = document.getElementById("roleList1Mark").childNodes.length;
                        console.log(roleList1MarkChild);
                        if (roleList1MarkChild == 0) {
                            let toGachaBlk = document.getElementById('toGachaBlk');
                            toGachaBlk.classList.remove('none');
                        }
                    },
                    error: function (exception) {
                        alert("數據載入失敗: " + exception.status);
                    }
                });

            
        }
        function toTwo(item) {
            document.getElementById('one').classList.add('none');
            document.getElementById('popUpBox2').classList.remove('none');
            let imgg = item.querySelector("img");
            //////////// 我的角色圖片

            let imgSrc = imgg.attributes['src'].value;
            let myRoleImg = document.getElementById('myRoleImg1');
            myRoleImg.attributes['src'].value = imgSrc;

            //////////// 我的角色名字

            let imgName = imgg.attributes['id'].value;
            let myRoleName = document.getElementById('myRoleName1');
            myRoleName.innerText = imgName;
            //console.log(imgName);

            //////////// 你的角色圖片

            // console.log(item.childNodes[1].attributes['name'].value);
            console.log(item.parentNode.parentNode.parentNode.parentNode.childNodes[4].attributes['name'].value);
            
            //console.log(yourImg);
            yourImgSrc = item.childNodes[1].attributes['class'].value
            let yourRoleImg1 = document.getElementById('yourRoleImg1');
            yourRoleImg1.attributes['src'].value = yourImgSrc;
            let name = item.childNodes[1].attributes['name'].value
            let yourname = document.getElementById('yourRoleName1');
            yourname.innerText = name;
            let productID = item.parentNode.parentNode.parentNode.parentNode.childNodes[4].attributes['name'];
            let yourPID = item.childNodes[1].attributes['id'].value;
            console.log(productID);
            productID.value = yourPID;
            console.log(productID);
        }
        function toBack() {
            document.getElementById('one').classList.remove('none');
            document.getElementById('popUpBox2').classList.add('none');
        };
        function toThree(item) {
            document.getElementById('one').classList.add('none');
            document.getElementById('popUpBox2').classList.add('none');
            document.getElementById('three').classList.remove('none');

            let imgBlock1Mark = document.getElementById("imgBlock1Mark");
            let FK_GACHA_ID = imgBlock1Mark.attributes['name'].value;
            console.log(FK_GACHA_ID);

            console.log(item.parentNode.parentNode.parentNode.childNodes[4].attributes['name'].value);
            // let iimgBlock = document.getElementById("iimgBlock");
            let PRODUCT_ID = item.parentNode.parentNode.parentNode.childNodes[4].attributes['name'].value;

            $.ajax({
                method: "POST",
                url: "../php/product/insertByCheck.php",
                data: {
                    // FK_USERNAME_BUY: FK_USERNAME_BUY,
                    FK_PRODUCT_ID: PRODUCT_ID,
                    FK_GACHA_ID_BUY: FK_GACHA_ID,

                },
                dataType: "TEXT",
                success: function (response) {

                },
                error: function (exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });

        }

        function clickClose() {
            document.getElementById('transBlk').classList('transBlk');
        }

        function popClose(item) {
            let blk = item.parentNode.parentNode.parentNode.parentNode;
            blk.classList.add('none');
        }
        function popCloseX(item) {
            let blk = item.parentNode.parentNode.parentNode;
            blk.classList.add('none');
        }
        function toGacha() {
            location.href = "./Gacha.html";
        };
        function toPoints() {
            location.href = "./deposit.html";
        };
    </script>
</body>

</html>