<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="../js/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.6.2/vuex.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>角色交易</title>

    <style>
      .maskLayer{
          display: none;
      }
      .popShow{
          display: block;
      }
      .popUpBox{
          display: none;
      }
      .box1{
          display: block;
      }


    </style>

</head>
<body>
  @@include('./header.html')
<main class="allBlock1">
  


<!-- 角色排行 -->

    <section class="roleRanksection">
        <h1>角色排行</h1>
        <div class="rankBloCk">
            <div class="roleBloCk1">
                <div class="imgBlock">
                    <img src="../image/trade/rank1.png" >
                </div>
    
                <div class="name">
                    <p>微笑虎</p>
                </div>
    
                <div class="price">$2660E</div>
            </div>

            <div class="roleBloCk2">
                <div class="imgBlock">
                    <img src="../image/trade/rank2.png" >
                </div>
    
                <div class="name">
                    <p>呆呆貓咪</p>
                </div>
    
                <div class="price">$3750E</div>
            </div>

            <div class="roleBloCk3">
                <div class="imgBlock">
                    <img src="../image/trade/rank3.png" >
                </div>
    
                <div class="name">
                    <p>貓頭鷹</p>
                </div>
    
                <div class="price">$2510E</div>
            </div>
        </div>
    </section>


<!-- 角色上架pop -->


    <main class="roleUpPop" id="app">

      <div class="btnBlockmy" id="box">
        <button type="button" class="btn111" @click=clickPop()>角色上架</button>
        <button type="button" class="btn222" @click=toThree()>我的角色管理</button>
      </div>

  
      <template id="=hiddenPopUps">
  
        <section class="maskLayer" :class="{'popShow':pop}">
  

<!-- 角色上架pop-1 -->


          <div class="popUpBox" :class="{'box1':one}">
              <div class="closeBtn" @click=clickClose()>
                x
              </div>
              <div class="popContent">
                <h1>角色上架</h1>
                <div class="input">
                    <div class="chooseRoleBlockk">
                      <h3>選擇角色</h3>
                      <div class="chooseRoleBlock" id="chooseRole">
                        <!-- 小圖 -->
                      </div>
                    </div>  
                  <div class="showImgBlock" id="showImgBlock">
                    <img src="" id="showImg" name="" alt="">
                  </div>
                  <div class="informationBlock" action="" method="post" >
                    <h3 id="roleName"></h3>
                    
                    <label class="sellerAccountt" id="sellerAccount">賣家帳號: <span id="innerAccount"></span></label>
                    
                    <br>
                    
                    <label class="pricee"><span>販售價格: </span><input type="text" id="price" placeholder="請輸入價格" name="sellprice"></label>
                    
                    <br>
                      
                    <div class="openChange">
                        <label id="openChange"><span>開啟交換:</span> 
                          <input type="radio" name="choice" value="1" checked>
                          開啟
                          <input id="choice" type="radio" name="choice" >
                          關閉
                        </label>
                    </div>
                  
                    <br>

                    <div class="aBtnBlock">
                      <button class="aBtn" type="submit" @click=toTwo()>確定</button>
                    </div>
                    
                  </div>
                  
              </div>
            </div>
          </div>
        
<!-- 角色上架pop-2   -->

          <div class="popUpBox" :class="{'box1':two}">
              <div class="closeBtn" @click=clickClose()>
                  x
              </div>
              <div class="popContent2" id="completeWord">
                  您已完成角色上架
              </div>
              <div class="bBlock">
                <button class="b" @click=clickClose1()>確定</button>
              </div>
          </div>

<!-- 角色管理pop -->

          <div class="popUpBox" :class="{'box1':three}">
            <div class="closeBtn" @click=clickClose()>
              x
            </div>
            <div class="popContent3">
              <h1>角色管理</h1>
              <div class="manageFlex">
                <ol class="manageListOut">
                  <li>
                    <div class="itemFlex first">  
                      <div class="leftBlock">
                        <div class="imgBlockRole">
                          <img src="../image/trade/product1.png" style="visibility: hidden">
                        </div>
                      </div>

                      <div class="middleBlock">
                        <div class="detailInfo firstTitle">
                          <p class="roleNamee one">名稱</p>
                          <p class="rolePrice one">價錢</p>
                          <p class="roleNumber one">角色編號</p>
                        </div>
                      </div>
                      
                      <div class="rightBlock">
                        <div class="btnBlock" style="visibility: hidden">
                          <button class="downBt">下架</button>
                          <button class="upBt">重新上架</button>
                          <button class="deleteBt"><i class="fas fa-trash"></i></button>
                        </div>
                      </div>
                    </div>
                  </li>
                </ol>

                <ol class="manageList" id="manageList">

                  <li>
                    <!-- <div class="itemFlex">  
                      <div class="leftBlock">
                        <div class="imgBlockRole">
                          <img src="../image/trade/product2.png">
                        </div>
                      </div>

                      <div class="middleBlock">
                        <div class="detailInfo">
                          <p class="roleNamee">綠色怪物</p>
                          <p class="rolePrice">$250E</p>
                          <p class="roleNumber">abc153</p>
                        </div>
                      </div>
                      
                      <div class="rightBlock">
                        <div class="btnBlock">
                          <button class="downBt">下架</button>
                          <button class="upBt">重新上架</button>
                          <button class="deleteBt"><i class="fas fa-trash"></i></button>
                        </div>
                      </div>
                    </div> -->
                  </li>

                  
                </ol>

                
              </div>
            </div>
          </div>
        </section>
  
      </template>
  
  
    </main>


<!-- 搜尋列 -->


    <section class="searchFlex">
      <div class="searchFlexleft">
        <input type="text" name="search" id="ysearchy" placeholder="請輸入角色名稱">
        <button class="ysearchBtny" type="submit"><i class="fas fa-search"></i></button>
      </div>

      <div class="searchFlexRight">
        <button class="openBtn" data-toggle-class="foo" data-target="#bar" type="button">搜尋分類+</button>
        <div id="bar" class="none">
            <div> 
                <input type="checkbox" id="1">
                <label for="1">$3000E以上</label>
            </div>
            <div> 
                <input type="checkbox" id="2">
                <label for="2">$2000E~$3000E</label>
            </div>
            <div> 
                <input type="checkbox" id="3">
                <label for="3">$1000E~$2000E</label>
            </div>
            <div> 
                <input type="checkbox" id="4">
                <label for="4">$1000E以下</label>
            </div>
            <div> 
                <input type="checkbox" id="5">
                <label for="5">可交換</label>
            </div>
        </div>
        
      </div>
    </section>



<!-- 商品列表 -->

    <main class="ymainy">
      <div class="containerFlex">
        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                  <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

        <div class="container">
          <a href="./product.html">
            <div class="inner">
                <div class="content">

                    <span><img src="../image/trade/product1.png"></span>
                    <h2>小烏龜</h2>
                    <h3>$250E</h3>
                </div>
                <div class="lower">
                    <ul class="features-list">
                        <li>可交換</li>
                        <div class="ysellerImgy">
                          <img src="../image/trade/sellerimg1.png" alt="">
                        </div>
                        <li>Slapaye</li>
                    </ul>
                </div>
            </div>
            <button class="cta">查看資訊</button>
          </a>
        </div>

      </div>
        
    </main>

    <section class="ypagey">
        <div class="pagination">
          <ul class="pagination_list">
            <li><a href="#"><img src="../image/trade/arrow_left.png"></a></li>
            <li class="focus"><a href="#" ></a>1</li>
            <li><a href="#"></a>2</li>
            <li><a href="#"></a>3</li>
            <li><a href="#"></a>4</li>
            <li><a href="#"></a>5</li>
            <li><a href="#"></a>6</li>
            <li><a href="#"></a>7</li>
            <li><a href="#"></a>8</li>
            <li><a href="#"></a>9</li>
            <li><a href="#"><img src="../image/trade/arrow_right.png"></a></li>
          </ul>
        </div>
      </section>
    </main>
    @@include('./footer.html')
    



    <script>

      let vm = new Vue({
          el: "#app",
          data: {
              pop:false,
              one:true,
              two:false,
              three:false,
          },
          methods: {
              clickPop() {
                  vm.$data.pop = true;
                  vm.$data.one = true;
                  vm.$data.three = false;
                  $.ajax({
                    method: "POST",
                        url: "../php/product/callMemberRole.php",
                        data: {
                          Name:'JERRY',
                        },
                        dataType: "json",
                        success: function (response) {

                            let chooseRole = document.getElementById('chooseRole');
                            chooseRole.innerHTML= "";
                            //chooseRole.insertAdjacentHTML("afterbegin",` <h3>選擇角色</h3>`);
                          
                            let innerAccount = document.getElementById('innerAccount');
                            innerAccount.innerHTML= "";
                            

                            $.each(response, function (index, row) {
                                let str = ` <img src="../image/ROLE/${row.ROLE_IMG}" onclick="chooseImg(this)" style="width:120px;" id="${row.RNAME}" name= "${row.FK_GACHA_ID}" alt="${row.STATUS}">`;
                                chooseRole.insertAdjacentHTML("beforeend",str);
                                innerAccount.innerHTML= `${row.FK_USERNAME}`;
                                
                                
                            })
                            let chooseRoleChild = document.getElementById("chooseRole").childNodes[1];
                            let showImg = document.getElementById("showImg");
                            let N = chooseRoleChild.attributes['src'].value;
                            showImg.attributes['src'].value = `${N}`;
                            let roleName = document.getElementById('roleName');
                            let roleId = chooseRoleChild.attributes['id'].value;
                            let gachaId = chooseRoleChild.attributes['name'].value;
                            roleName.innerText = roleId;
                            showImg.attributes['name'].value = gachaId;
                            let status = chooseRoleChild.attributes['alt'].value;
                            showImg.attributes['alt'].value = status;
                        },
                        error: function (exception) {
                            alert("數據載入失敗: " + exception.status);
                        }
                    });
                  

              },
              clickClose() {
                  vm.$data.pop = false;
              },
              toTwo(){
                // console.log(document.getElementById('choice').value);
                let check = document.querySelector('input[id="choice"]:checked');
                let checkValue = null;
                if(check != null){
                  checkValue = 0;
                }else{
                  checkValue = 1;
                }
                //console.log(checkValue);
                
                let username = document.getElementById('innerAccount').innerText;
                //console.log(username);
                
                let price = document.getElementById('price').value;
                //console.log(price);
                
                let gachaId = document.getElementById("showImg").attributes['name'].value;
                //console.log(gachaId);
                
                let status = document.getElementById("showImg").attributes['alt'].value;
                //console.log(status);

                if(status == 1){
                  status = 0;
                }else{
                  status = 1;
                }


                if (price == "") {
                alert("填寫販售價格");
                return false;
                }

                // 上架功能

                  $.ajax({
                    method: "POST",
                        url: "../php/product/upProduct.php",
                        data: {
                          GACHA_ID: gachaId,
                          USERNAME: username,
                          PRICE: price,
                          TRANS: checkValue,
                          STATUS: status,
                        },
                        dataType: "text",
                        success: function (response) {
                        vm.$data.two = true;
                        vm.$data.one = false;
                        },
                        error: function (exception) {
                            alert("數據載入失敗: " + exception.status);
                        }
                    });

                    
                    
              },
              clickClose1() {
                  vm.$data.pop = false;
                  vm.$data.two = false;
              },
              toThree(){
                vm.$data.pop = true;
                vm.$data.three = true;

                $.ajax({
                    method: "POST",
                        url: "../php/product/rollManage.php",
                        data: {
                          Name:'JERRY',
                        },
                        dataType: "json",
                        success: function (response) {

                            let manageList = document.getElementById('manageList');
                            manageList.innerHTML= "";

                            $.each(response, function (index, row) {
                                let liList1 = `<li>
                                              <div class="itemFlex">  
                                                <div class="leftBlock">
                                                  <div class="imgBlockRole">
                                                    <img src="../image/ROLE/${row.ROLE_IMG}" name= "${row.ISSHOW}" id= "roleImgg">
                                                  </div>
                                                </div>

                                                <div class="middleBlock">
                                                  <div class="detailInfo">
                                                    <p class="roleNamee">${row.RNAME}</p>
                                                    <p class="rolePrice">${row.PRICE}</p>
                                                    <p class="roleNumber" id="roleNumber">${row.FK_GACHA_ID}</p>
                                                  </div>
                                                </div>
                      
                                                <div class="rightBlock">
                                                  <div class="btnBlock"  id="changeStatus">
                                                    <button class="downBt" onclick="down(this)">下架</button>
                                                  </div>
                                                </div>
                                              </div>
                                            </li>`;
                                let liList0 = `<li>
                                              <div class="itemFlex">  
                                                <div class="leftBlock">
                                                  <div class="imgBlockRole">
                                                    <img src="../image/ROLE/${row.ROLE_IMG}" name= "${row.ISSHOW}" id= "roleImgg">
                                                  </div>
                                                </div>

                                                <div class="middleBlock">
                                                  <div class="detailInfo">
                                                    <p class="roleNamee">${row.RNAME}</p>
                                                    <p class="rolePrice">${row.PRICE}</p>
                                                    <p class="roleNumber">${row.FK_GACHA_ID}</p>
                                                  </div>
                                                </div>
                      
                                                <div class="rightBlock">
                                                  <div class="btnBlock" id="changeStatus">
                                                    <button class="upBt">重新上架</button>
                                                    <button class="deleteBt"><i class="fas fa-trash"></i></button>
                                                  </div>
                                                </div>
                                              </div>
                                            </li>`;
                                if(row.ISSHOW == 1){
                                    manageList.insertAdjacentHTML("beforeend",liList1);
                                }else{
                                    manageList.insertAdjacentHTML("beforeend",liList0);
                                }
                            })

                            


                        },
                        error: function (exception) {
                            alert("數據載入失敗: " + exception.status);
                        }
                    });
              }
          },
      });

    </script>

<!-- 搜尋開關 -->
  
  <script>
      const toggleClass  = document.querySelectorAll('[data-toggle-class]');
        if (toggleClass) {
          for (let i = 0; i < toggleClass.length; i += 1) {
            const elem = toggleClass[i];
            elem.addEventListener('click', () => {
              const className = elem.getAttribute('data-toggle-class');
              const target = elem.getAttribute('data-target').slice(1);
              document.getElementById(target).classList.toggle(className);
            });
          }
        }
    </script>
  


  <!-- 點小圖切換圖片 -->

    <script>
      function chooseImg(item){
        console.log(item);
        let N = item.attributes['src'].value;
        //console.log(N);
        showImg.attributes['src'].value = `${N}`;
        let roleName = document.getElementById('roleName');
        roleName.innerHTML= item.attributes['id'].value;
        let name = item.attributes['name'].value;
        showImg.attributes['name'].value = name;
            }
    
    </script>

<!-- 下架功能 -->

    <script>
        function down(item){
            //console.log(item);
            item.classList.add('none');
            let changeStatus = document.getElementById('changeStatus');
            let str = `
            <button class="upBt">重新上架</button>
            <button class="deleteBt"><i class="fas fa-trash"></i></button>
            `;
            changeStatus.innerHTML = str;
            let gachaID = document.getElementById('roleNumber').innerText;
            let b = document.getElementById('roleImgg');
            isShow = b.attributes['name'].value;
            if(isShow == 1){
                isShow = 0;
            }else{
                isShow = 1;
            }



            $.ajax({            
                method: "POST",
                url: "../php/product/down.php",
                data:{
                    GACHA_ID:gachaID,
                    ISSHOW:isShow
                },            
                dataType: "json",
                success: function (response) {                
                                                
                },
                error: function(exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });

        }
    
    </script>




    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
</body>
</html>
