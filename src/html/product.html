<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="../js/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuex/3.6.2/vuex.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>商品頁</title>
    <script>

        window.onload = function getproductname() {
            status();
            callProductInfo();
            setTimeout(function () {
                myFavStatus();
            }, 2000);
            chart()

        }

        function chart() {
            let chart = document.getElementById('myChart').getContext('2d');
            let ab = sessionStorage.getItem('ab');
            let num = `"${ab}"`;
            let ab1 = num.slice(1, 2);
            let ab2 = num.slice(2, 3);
            let ab3 = num.slice(3, 4);
            let ab4 = num.slice(4, 5);
            let ab5 = num.slice(5, 6);

            const chartData = {
                labels: [
                    '加速',
                    '抓地',
                    '碰撞',
                    '迴避',
                    '道具'
                ],
                datasets: [{
                    label: '',
                    data: [ab1, ab2, ab3, ab4, ab5],
                    fill: true,
                    fillStyle: 'red',
                    backgroundColor: ' rgba(14, 52, 97, .5)',
                    borderColor: 'rgba(16, 197, 177, 1)',
                    pointRadius: 6,
                    pointBackgroundColor: 'rgba(14, 52, 97, .1)',
                    pointBorderColor: 'rgba(2, 79, 63, 1)',
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: 'rgba(16, 197, 177, .5)',
                    pointHoverBorderColor: 'rgba(14, 52, 97, 1)',
                }]
            };
            const firstChart = new Chart(chart, {
                type: 'radar',
                data: chartData,
                options: {
                    plugins: {
                        legend: {
                            display: false,
                        }
                    },
                    scales: {
                        r: {
                            pointLabels: {
                                font: {
                                    size: 16,
                                }
                            },
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 10
                        }
                    },
                    elements: {

                        line: {
                            borderWidth: 5
                        }
                    }
                },
            });
        }

        function owner (username){
            let sellerName = username;
            let myfavBtn = document.getElementById("myfav");
            let changeBtn = document.getElementById("changeBtn");
            let buyBtn = document.getElementById("buyBtn");
            $.ajax({
                method: "POST",
                url: "../php/product/getBuyer.php",
                data: {},
                dataType: "text",
                success: function (response) {
                    console.log(response);
                    // 買家賣家不同人
                    if(sellerName == response){
                        myfavBtn.disabled = true;
                        changeBtn.disabled = true;
                        buyBtn.disabled = true;
                        myfavBtn.style.opacity = ".4";
                        changeBtn.style.opacity = ".4";
                        buyBtn.style.opacity = ".4";
                    }else{
                        myfavBtn.disabled = false;
                        changeBtn.disabled = false;
                        buyBtn.disabled = false;
 
                    }
                }
            });
        }

        function callProductInfo() {
            let productid = sessionStorage.getItem('productname');
            $.ajax({
                method: "POST",
                url: "../php/product/callproductname.php",
                data: {
                    GACHAID: productid,
                },
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    let username = response[0][1];
                    let gachaid = response[0][2];
                    let price = response[0][3];
                    let title = response[0][12];
                    let img = response[0][14];
                    let content = response[0][16];
                    let trans = response[0].TRANS;
                    let PRODUCT_ID = response[0].PRODUCT_ID;
                    let block_product = document.getElementById("flexContainer");
                    let str = `
                    <div class="items -left" id="username" name="${username}">
                        <div class="imgBlock" id="iimgBlock" name='${PRODUCT_ID}'>
                            <img id='${PRODUCT_ID}' src="../image/ROLE/${img}">
                        </div>
                    </div>
                    <div class="items -right">
                        <h1 class="title1" id="title1">${title}</h1>
                        <p class="introduce">${content}</p>
                        <p class="price">$${price}E</p>

                        <div class="collectForm">
                            <div class="btnBlock1">
                                <button type="${gachaid}" class="collectBtn" name="button" id="myfav" onclick="myfav()"><i class="fas fa-heart"></i>收藏</button>
                                <button type="button" id="changeBtn" class="changeBtn" name="button" onclick="clickStatus()">交換</button>
                            </div>
                        </div>

                        <div class="buyForm" id="app">
                            <button type="button" class="buyBtn" id="buyBtn" name="button" onclick="clickStatus1()">購買</button>
                            <component :is="content" id="popUp" @nextacc="myClick" @click-2="myClick2"></component>
                        </div>
                    </div>
                    `;
                    block_product.innerHTML = str;

                    // 判斷是否開啟交換

                    let changeBtn = document.getElementById("changeBtn");
                    console.log(trans);
                    if(trans == 0){
                        changeBtn.classList.add('none');
                    }else{
                        changeBtn.classList.remove('none');
                    }
                    owner(username);
                },
                error: function (exception) {
                    alert("發生錯誤: " + exception.status);
                }
            });
        }
        function myFavStatus() {
            let productid = sessionStorage.getItem('productname');
            let btn = document.getElementById('myfav');

            $.ajax({
                method: "POST",
                url: "../php/product/loadMyFav.php",
                data: {
                    productID: productid,
                },
                dataType: "text",
                success: function (response) {
                    console.log(btn);
                    if (response == "YY") {
                        btn.style.background = "rgba(96, 205, 144, 1)";
                        btn.style.color = "rgba(14, 52, 97, 1)";
                        btn.style.boder = "3px solid rgba(14, 52, 97, 1)";
                        btn.innerText = "已收藏";
                    } else if (response == "YN") {
                        btn.style.background = "rgba(14, 52, 97, 1)";
                        btn.style.color = "rgba(96, 205, 144, 1)";
                        btn.style.boder = "3px solid rgba(14, 52, 97, 1)";
                    }
                }
            });
        }

    </script>

</head>
<header></header>

<body>
    <header id="header">
        <div class="container">
            <a class="logo" href="../html/index.html">
                <img src="../image/index/logo.png" alt="logoImg">
            </a>
            <nav class="navbar">
                <ul>
                    <a href="../html/Intro.html">
                        <li>
                            <img src="../image/index/pic.png">
                            消息/介紹
                        </li>
                    </a>
                    <a href="../html/Gacha.html">
                        <li>
                            <img src="../image/index/pokemon.png">
                            角色抽取
                        </li>
                    </a>
                    <a href="../html/trade.html">
                        <li class="Change">
                            <img src="../image/index/role01.png">
                            角色交易
                        </li>
                    </a>
                </ul>
            </nav>
    
            <!-- phone nav-->
            <nav class="hamburger">
                <div id="menuToggle">
                    <input type="checkbox" />
    
                    <span></span>
                    <span></span>
                    <span></span>
    
                    <ul id="headerMenu">
                        <a href="../html/index.html"><img src="../image/index/logo.png"></a>
                        <a href="../html/Intro.html">
                            <li><img src="../image/index/pic.png">消息/介紹</li>
                        </a>
                        <a href="../html/Gacha.html">
                            <li><img src="../image/index/pokemon.png">角色抽取</li>
                        </a>
                        <a href="../html/trade.html">
                            <li><img src="../image/index/role01.png">角色交易</li>
                        </a>
                        <a href="#">
                            <div class="hamLog " id="LogOutPhone" onclick="LogOut()">登出</div>
                        </a>
                        <a href="#">
                            <div class="hamLog logbt LogInPhone" id="LogInPhone" onclick="LogIn()">登入</div>
                        </a>
                    </ul>
                </div>
            </nav>
            <!-- phone nav end -->
    
            <div class="icon">
                <botton type="button" class="button bt disappear" id="appear1">
                    <a href="../html/deposit.html"><i class="fas fa-coins fa-2x"></i></a>
                    <p id="headerResult"></p>
                    <div class="show">儲值</div>
                </botton>
                <botton type="button" class="button disappear" id="appear2">
                    <a href="../html/collection.html"><i class="fab fa-gratipay fa-2x"></i></a>
                    <div class="show">收藏</div>
                </botton>
                <botton type="button" class="button" onclick="memberCheck()">
                    <a href="#"><i class="fas fa-user-circle fa-2x"></i>
                        <h5 id="headerCountResult" class="countResul _off"></h5>
                    </a>
                    <div class="show">會員</div>
                </botton>
                <botton type="button" id="LogOut" class="LogOut" onclick="LogOut()">
                    <a href="#">登出</a>
                </botton>
                <botton type="button" id="LogIn" class="LogIn logbt" onclick="LogIn()">
                    <a href="#">登入</a>
                </botton>
            </div>
        </div>
    </header>
    <main class="allBlock" id="appp">
        <p class="p">首頁>角色交易>所有消息</p>


        <!-- 拒絕自我交易 -->

        <div id="selfBlk" class="selfBlk none">
            <section class="selfHintmaskLayer">
                <div class="selfPopUpBox">
                    <div onclick="popCloseX(this)" class="selfCloseBtn">
                        x
                    </div>
                    <div class="selfPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;不能對自己的商品做交易請求喔！
                        </p>
                    </div>
                    <div class="selfConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <!-- <button class="bonusConfirmBtn" onclick="tologIn()">登入或註冊～</button> -->
                    </div>
                </div>
            </section>
        </div>

                <!-- 收藏成功alert -->

                <div id="myfavBlk" class="toGachaBlk none">
                    <section class="toGachaHintmaskLayer">
                        <div class="toGachaPopUpBox">
                            <div onclick="popCloseX(this)" class="toGachaCloseBtn">
                                x
                            </div>
                            <div class="toGachaPopContent">
                                <p>
                                    <i class="far fa-user-circle"></i>&nbsp;您已成功收藏
                                </p>
                            </div>
                            <div class="toGachaConfirmBlk">
                                <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 取消收藏alert -->

                <div id="cancelmyfavBlk" class="toGachaBlk none">
                    <section class="toGachaHintmaskLayer">
                        <div class="toGachaPopUpBox">
                            <div onclick="popCloseX(this)" class="toGachaCloseBtn">
                                x
                            </div>
                            <div class="toGachaPopContent">
                                <p>
                                    <i class="far fa-user-circle"></i>&nbsp;您已取消收藏
                                </p>
                            </div>
                            <div class="toGachaConfirmBlk">
                                <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                            </div>
                        </div>
                    </section>
                </div>

        


        <!-- 未登入alert -->

        <div id="tologinBlk" class="toGachaBlk none">
            <section class="toGachaHintmaskLayer">
                <div class="toGachaPopUpBox">
                    <div onclick="popCloseX(this)" class="toGachaCloseBtn">
                        x
                    </div>
                    <div class="toGachaPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您尚未登入會員喔
                        </p>
                    </div>
                    <div class="toGachaConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <button class="bonusConfirmBtn" onclick="tologIn()">登入或註冊～</button>
                    </div>
                </div>
            </section>
        </div>


        <!-- 沒角色alert -->


        <div id="toGachaBlk" class="toGachaBlk none">
            <section class="toGachaHintmaskLayer">
                <div class="toGachaPopUpBox">
                    <div onclick="popCloseX(this)" class="toGachaCloseBtn">
                        x
                    </div>
                    <div class="toGachaPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您的角色不足，請前往扭蛋
                        </p>
                    </div>
                    <div class="toGachaConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <button class="bonusConfirmBtn" onclick="toGacha()">前往扭蛋</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- 沒有點數alert -->

        <div id="noPointBlk" class="noPointBlk none">
            <section class="noPointHintmaskLayer">
                <div class="noPointPopUpBox">
                    <div onclick="popCloseX(this)" class="noPointCloseBtn">
                        x
                    </div>
                    <div class="noPointPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您的點數不足，請前往儲值
                        </p>
                    </div>
                    <div class="noPointConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="popClose(this)">我知道了</button>
                        <button class="bonusConfirmBtn" onclick="toPoints()">前往儲值</button>
                    </div>
                </div>
            </section>
        </div>

        <!-- 購買成功 -->

        <div id="successBlk" class="noPointBlk none">
            <section class="noPointHintmaskLayer">
                <div class="noPointPopUpBox">
                    <div onclick="popCloseX(this)" class="noPointCloseBtn">
                        x
                    </div>
                    <div class="noPointPopContent">
                        <p>
                            <i class="far fa-user-circle"></i>&nbsp;您已購買成功
                        </p>
                    </div>
                    <div class="noPointConfirmBlk">
                        <button class="bonusConfirmBtn" onclick="toTrade()">確定</button>
                        <!-- <button class="bonusConfirmBtn" onclick="toPoints()">前往儲值</button> -->
                    </div>
                </div>
            </section>
        </div>


        <!-- 交換視窗 -->

        <section class="sec1">
            <div class="flexContainer" id="flexContainer">
            </div>

            <main class="test">
                <template id="=hiddenPopUps">

                    <section class="maskLayer" :class="{'popShow':pop}">

                        <div class="popUpBox one" :class="{'box':one}">
                            <div class="closeBtn" @click=clickClose()>
                                x
                            </div>
                            <div class="popContent12">
                                <p>選擇你要申請交換的角色</p>
                            </div>

                            <div class="roleBlock1Mark">
                                <ul class="roleList1Mark" id="roleList1Mark">

                                </ul>
                            </div>



                        </div>


                        <div id="popUpBox2" class="popUpBox" :class="{'box':two}">
                            <div class="closeBtn" @click=clickClose()>
                                x
                            </div>
                            <div class="popContent13">
                                <p>確認你想要交換的角色</p>
                            </div>
                            <div class="roleArea">
                                <div class="myRoleBlock">
                                    <div class="myRoleP">
                                        <p>我的角色</p>
                                    </div>

                                    <div class="myRoleImg">
                                        <img id="myRoleImg1" src="">
                                    </div>

                                    <div class="myRoleNameBlock">
                                        <p id="myRoleName1"></p>
                                    </div>
                                </div>

                                <div class="doubleArrow"><i class="fas fa-arrows-alt-h"></i></div>

                                <div class="yourRoleBlock">
                                    <div class="yourRoleP">
                                        <p>對方角色</p>
                                    </div>

                                    <div class="yourRoleImg">
                                        <img id="yourRoleImg1" src="">
                                    </div>    
                                    <div class="yourRoleNameBlock">
                                        <p id="yourRoleName1"></p>
                                    </div>
                                </div>    
                            </div>
                            <div class="confirmBlk13">
                                <button href="#" class="confirmBtnBack13" @click=toBack()>返回</button>
                                <button href="#" class="confirmBtn13" onclick="toThree()">確定</button>
                            </div>

                        </div>

                        <div class="popUpBox" :class="{'box':three}">
                            <div class="closeBtn" @click=clickClose()>
                                x
                            </div>
                            <div class="popContent14">
                                <p class="sendP">已送出交換申請</br>請靜候佳音！</p>
                            </div>

                        </div>
                    </section>

                </template>
            </main>
        </section>







        <!-- 雷達圖 -->

        <div class="chart"><canvas id="myChart"></canvas></div>

        <!-- 能力值     -->
        <div class="tableBlock">
            <table>
                <tr>
                    <th>能力值</th>
                    <th>說明</th>
                </tr>

                <tr>
                    <th>加速</th>
                    <td>能力值越高可以越快到達最高速度。</td>
                </tr>

                <tr>
                    <th>抓地</th>
                    <td>能力值越高轉彎幅度就會越小。</td>
                </tr>

                <tr>
                    <th>碰撞</th>
                    <td>能力值越高在惡路上行駛時的減速就會越小。</td>
                </tr>

                <tr>
                    <th>迴避</th>
                    <td>能力值越高越不容易在與對手碰撞時彈飛。</td>
                </tr>

                <tr>
                    <th>道具</th>
                    <td>能力值越高越容易獲得道具。</td>
                </tr>

            </table>

        </div>

    

    </main>
    <!-- footer -->
    <footer class="footer">
        <div class="iconLink">
            <a href="#"><i class="fab fa-facebook-square fa-2x i"></i></a>
            <a href="#"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="#"><i class="fab fa-twitter-square fa-2x i"></i></a>
        </div>
        <div class="notice">
            <p>
                本網站為緯育TibaMe前端設計工程師班第70期第一組學員專題成果作品，本平台僅供學習、展示之用。<br>
                參考資源： 馬力歐賽車、NFT。若有侵權疑慮，您可以私訊 [ 緯育TibaMe ]，後續會由專人協助處理
            </p>
        </div>
        <div class="copyright">
            <p><i class="far fa-copyright"></i> 2021 怪哩怪汽 All Rights Reserved</p>
        </div>
    </footer>



    <script>
        Vue.component(`maskBlock`, {
            template: `
            <section class="maskBlockM" id="maskBlock">
                <div class="popUpBox abc">
                    <div class="closeBtn" @click="clickClose">
                        x
                    </div>
                    <div class="popContent">
                        <p>是否確認從帳戶扣除 $***點，交易 *****角色?</p>
                    </div>
                    <div class="confirmBlk">
                        <a href="#" class="confirmBtn" @click="next">是</a>
                        <a href="#" class="confirmBtn" @click="clickClose">否</a>
                    </div>
                </div>
            </section>
            `,
            methods: {
                clickClose() {
                    vmm.content = false;
                },
                next() {
                    this.$emit('nextacc', 'maskBlock2');
                }
            },


        });

        Vue.component(`maskBlock2`, {
            template: `
                <section class="maskBlockM">
                    <div class="popUpBox abc">
                        <div  class="closeBtn" @click="clickClose2">
                            x
                        </div>
                        <div class="popContent">
                            <p>您已成功購買</p>
                        </div>
                        <div class="confirmBlk" @click="clickClose2">
                            <a href="#" class="confirmBtn">確定</a>
                        </div>
                    </div>
            </section>
            `,
            methods: {
                clickClose2() {
                    this.$emit('click-2', 'false')
                }
            }
        });

    </script>

    <script>
        let vmm = new Vue({
            el: "#appp",
            data: {
                pop: false,
                one: true,
                two: false,
                three: false,
                content: false,
            },
            methods: {
                clickClose() {
                    vmm.$data.pop = false;
                },

                toBack() {
                    vmm.$data.pop = true;
                    vmm.$data.one = true;
                    vmm.$data.two = false;
                    vmm.$data.three = false;
                },

                myClick(val) {
                    this.content = val;
                },
                myClick2(r) {
                    this.content = r;
                },
            },
        });


        function clickStatus() {
            $.ajax({
                method: "POST",
                url: "../php/LoginCheck.php",
                data: {},
                dataType: "text",
                success: function (response) {
                    let tologinBlk = document.getElementById('tologinBlk');
                    if (response == "") {
                        tologinBlk.classList.remove('none');
                    } else {

                        let productid = sessionStorage.getItem('productname');
                        $.ajax({
                            method: "POST",
                            url: "../php/product/buyerCheck.php",
                            data: {
                                PRODUCT_ID: productid,
                            },
                            dataType: "text",
                            success: function (response) {
                                if (response == "N") {
                                    let selfBlk = document.getElementById('selfBlk');
                                    selfBlk.classList.remove('none');
                                } else {
                                    clickPopp();
                                }
                            }
                        });


                    }
                }
            })
        }
        function clickPop() {
            // console.log(e.target)
            alert();
            vmm.$data.content = 'maskBlock';
        }


        function clickPopp() {
            $.ajax({
                method: "POST",
                url: "../php/product/callChangeRole.php",
                data: {},
                dataType: "json",
                success: function (response) {

                    let roleList1Mark = document.getElementById('roleList1Mark');
                    roleList1Mark.innerHTML = "";

                    $.each(response, function (index, row) {
                        let str = `<li onclick=toTwo(this)>
                                            <div class="imgBlock1Mark" id="imgBlock1Mark" name="${row.GACHA_ID}">
                                                <img src="../image/ROLE/${row.ROLE_IMG}" id="${row.RNAME}" name= "${row.FK_USERNAME}">
                                            </div>
                                        </li>`;
                        roleList1Mark.insertAdjacentHTML("beforeend", str);


                    })
                    let roleList1MarkChild = document.getElementById("roleList1Mark").childNodes.length;
                    console.log(roleList1MarkChild);
                    // 判斷是否有角色
                    let toGachaBlk = document.getElementById('toGachaBlk');
                    if (roleList1MarkChild == 0) {
                        toGachaBlk.classList.remove('none');
                        vmm.$data.pop = false;
                        vmm.$data.one = false;
                    }

                },
                error: function (exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });

            vmm.$data.pop = true;
            vmm.$data.one = true;
            vmm.$data.two = false;
            vmm.$data.three = false;
        }

        function toTwo(item) {
            vmm.$data.two = true;
            vmm.$data.one = false;
            vmm.$data.three = false;


            //console.log(item);
            let imgg = item.querySelector("img");
            //console.log(imgg);

            //////////// 我的角色圖片

            let imgSrc = imgg.attributes['src'].value;
            let myRoleImg = document.getElementById('myRoleImg1');
            myRoleImg.attributes['src'].value = imgSrc;

            //////////// 我的角色名字

            let imgName = imgg.attributes['id'].value;
            let myRoleName = document.getElementById('myRoleName1');
            myRoleName.innerText = imgName;
            //console.log(imgName);

            //////////// 你的角色圖片

            let imgBlock = document.getElementsByClassName("imgBlock")[0];
            //console.log(imgBlock);
            let yourImg = imgBlock.querySelector("img");
            //console.log(yourImg);
            yourImgSrc = yourImg.attributes['src'].value;
            let yourRoleImg1 = document.getElementById('yourRoleImg1');
            yourRoleImg1.attributes['src'].value = yourImgSrc;
            let name = document.getElementById("title1").innerText;
            let yourname = document.getElementById('yourRoleName1');
            yourname.innerText = name;
        }

        function toThree() {

            vmm.$data.three = true;
            vmm.$data.one = false;
            vmm.$data.two = false;

            let imgBlock1Mark = document.getElementById("imgBlock1Mark");
            let FK_GACHA_ID = imgBlock1Mark.attributes['name'].value;
            console.log(FK_GACHA_ID);


            let iimgBlock = document.getElementById("iimgBlock");
            let PRODUCT_ID = iimgBlock.attributes['name'].value;
            console.log(PRODUCT_ID);

            $.ajax({
                method: "POST",
                url: "../php/product/insertByCheck.php",
                data: {
                    // FK_USERNAME_BUY: FK_USERNAME_BUY,
                    FK_PRODUCT_ID: PRODUCT_ID,
                    FK_GACHA_ID_BUY: FK_GACHA_ID,

                },
                dataType: "TEXT",
                success: function (response) {

                },
                error: function (exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });

        }
    </script>


    <!-- 購買功能fuction -->



    <script>
        function clickStatus1() {
            let iimgBlock = document.getElementById("iimgBlock");
            let PRODUCT_ID = iimgBlock.attributes['name'].value;
            // console.log(PRODUCT_ID);

            $.ajax({
                method: "POST",
                url: "../php/LoginCheck.php",
                data: {},
                dataType: "text",
                success: function (response) {

                    let tologinBlk = document.getElementById('tologinBlk');

                    let successBlk = document.getElementById('successBlk');
                    if (response == "") {
                        // 沒有登入
                        tologinBlk.classList.remove('none');
                    } else if (response == "true") {
                        buyerCheck();
                    }
                }
            });

            function buyerCheck() {
                $.ajax({
                    method: "POST",
                    url: "../php/product/buyerCheck.php",
                    data: {
                        PRODUCT_ID: PRODUCT_ID,
                    },
                    dataType: "text",
                    success: function (response) {
                        if (response == "N") {
                            let selfBlk = document.getElementById('selfBlk');
                            selfBlk.classList.remove('none');
                        } else {
                            buyRole();
                        }
                    }
                });
            }

            function buyRole() {
                let noPointBlk = document.getElementById('noPointBlk');
                $.ajax({
                    method: "POST",
                    url: "../php/product/buyRole.php",
                    data: {
                        PRODUCT_ID: PRODUCT_ID,
                    },
                    dataType: "text",
                    success: function (response) {

                        if (response == "y") {
                            // 有錢而且成功
                            successBlk.classList.remove('none');

                        } else if (response = "no") {
                            // 沒錢
                            noPointBlk.classList.remove('none');
                        }
                    }
                })

            };
        }
    </script>
    <script>
        function myfav() {
            let productid = sessionStorage.getItem('productname');
            $.ajax({
                method: "POST",
                url: "../php/product/buyerCheck.php",
                data: {
                    PRODUCT_ID: productid,
                },
                dataType: "text",
                success: function (response) {
                    if (response == "N") {
                    } else {
                        return false;
                    }
                }
            });
            
            $.ajax({
                method: "POST",
                url: "../php/product/loadMyFav.php",
                data: {
                    productID: productid,
                },
                dataType: "text",
                success: function (response) {
                    let btn = document.getElementById('myfav');
                    if (response == "YN") {
                        let tomyfavBtn = document.getElementById('myfavBlk');
                        tomyfavBtn.classList.remove('none');
                        insertMyfav();
                        btn.style.background = "rgba(96, 205, 144, 1)";
                        btn.style.color = "rgba(14, 52, 97, 1)";
                        btn.style.boder = "3px solid rgba(14, 52, 97, 1)";
                        btn.innerText = "已收藏";
                    } else if (response == "N") {
                        let tologinBtn = document.getElementById('tologinBlk');
                        tologinBtn.classList.remove('none');
                    } else if (response == "YY") {
                        let cancelmyfavBtn = document.getElementById('cancelmyfavBlk');
                        cancelmyfavBtn.classList.remove('none');
                        deletemyfav(productid);
                        btn.style.background = "rgba(14, 52, 97, 1)";
                        btn.style.color = "rgba(96, 205, 144, 1)";
                        btn.style.boder = "3px solid rgba(96, 205, 144, 1)";
                        btn.innerText = "收藏";
                    }
                }
            });
        }

        function insertMyfav() {
            let productid = sessionStorage.getItem('productname');
            $.ajax({
                method: "POST",
                url: "../php/product/myfav.php",
                data: {
                    PRODUCTID: productid,
                },
                dataType: "text",
                success: function (response) {
                    let btnName = document.getElementById('myfav').innerText;
                    btnName.innerText = "已收藏";
                    
                    // document.getElementById('buyBlk').remove('none');
                },
                error: function (exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });
        }

        function deletemyfav(productid) {
            let cancel = document.getElementById('myfav'.innerText);
            $.ajax({
                method: "POST",
                url: "../php/product/deltemyfav.php",
                data: {
                    PRODUCTID: productid,
                },
                dataType: "text",
                success: function (response) {
                },
                error: function (exception) {
                    alert("數據載入失敗: " + exception.status);
                }
            });
        }

    </script>


    <!-- 未登入彈窗function -->

    <script>

        function popClose(item) {
            let blk = item.parentNode.parentNode.parentNode.parentNode;
            blk.classList.add('none');
        }
        function popCloseX(item) {
            let blk = item.parentNode.parentNode.parentNode;
            blk.classList.add('none');
        }
        function tologIn() {
            location.href = "./login.html";
        };
        function toGacha() {
            location.href = "./Gacha.html";
        };
        function toPoints() {
            location.href = "./deposit.html";
        };
        function toTrade() {
            location.href = "./trade.html";
        };



    </script>

    <script src="../js/gacha/chart.js"></script>
    <script src="../js/header/header.js"></script>


    <script src="../js/news/news_in.js"></script> 

</body>

</html>